{
  "projectMeta": {
    "name": "Kenny - Personal AI Assistant",
    "version": "Week 9",
    "lastUpdated": "2025-08-28T18:30:00Z",
    "status": "emergency-repair",
    "currentWeek": 9,
    "totalWeeks": 10
  },
  "requirements": [
    {
      "id": "REQ-001",
      "type": "functional",
      "description": "Local-first personal AI assistant for macOS",
      "priority": "critical",
      "status": "completed",
      "acceptanceCriteria": [
        "100% local processing",
        "Multi-app data ingestion",
        "Intelligent search and retrieval", 
        "Advanced AI capabilities"
      ],
      "addedDate": "2025-01-20T00:00:00Z"
    },
    {
      "id": "REQ-002",
      "type": "functional", 
      "description": "Reliable database path resolution for ingestion system",
      "priority": "critical",
      "status": "completed",
      "acceptanceCriteria": [
        "Database always created at mac_tools/kenny.db",
        "No nested directory creation", 
        "Working directory independence",
        "Consistent data accessibility"
      ],
      "addedDate": "2025-08-27T00:00:00Z"
    },
    {
      "id": "REQ-003",
      "type": "non-functional",
      "description": "Modern, performant chat UI based on 2024-2025 best practices",
      "priority": "high",
      "status": "in-progress",
      "acceptanceCriteria": [
        "Fixed height container prevents infinite vertical growth",
        "Dark mode support (67% eye strain reduction)",
        "Animated elements (20% perceived performance improvement)",
        "Sub-3 second load times (90% retention threshold)",
        "Proper message bubble sizing",
        "Typing indicators and smooth transitions"
      ],
      "addedDate": "2025-08-28T00:00:00Z"
    }
  ],
  "roadmap": {
    "phases": [
      {
        "name": "Week 1-5: Foundation",
        "targetDate": "2025-08-21",
        "status": "completed",
        "milestones": [
          "Tool layer implementation",
          "Database schema and ingestion",
          "Apple app integration",
          "Search and retrieval system"
        ],
        "dependencies": []
      },
      {
        "name": "Week 6-8: Advanced AI Features", 
        "targetDate": "2025-09-11",
        "status": "active",
        "milestones": [
          "Email & Calendar Concierge",
          "Background jobs and daily briefing",
          "Security and prompt injection defense"
        ],
        "dependencies": []
      },
      {
        "name": "Week 9-10: Production Ready",
        "targetDate": "2025-09-25",
        "status": "in-progress",
        "milestones": [
          "Enterprise-ready deployment",
          "Performance optimization",
          "Security hardening"
        ],
        "dependencies": ["Week 6-8 completion"]
      }
    ]
  },
  "completedWork": [
    {
      "id": "WORK-001",
      "description": "Complete foundation implementation with tool layer, database, and ingestion",
      "completedDate": "2025-08-21T00:00:00Z",
      "relatedRequirement": "REQ-001", 
      "notes": "Week 1-5 deliverables completed with real data ingestion of 56,799 documents"
    },
    {
      "id": "WORK-002",
      "description": "Advanced AI-powered search and summarization architecture",
      "completedDate": "2025-08-26T00:00:00Z",
      "relatedRequirement": "REQ-001",
      "notes": "Hybrid search with semantic embeddings operational"
    },
    {
      "id": "WORK-003",
      "description": "Temporary database path resolution fix", 
      "completedDate": "2025-08-27T00:00:00Z",
      "relatedRequirement": "REQ-002",
      "notes": "Manual database relocation from mac_tools/mac_tools/kenny.db to mac_tools/kenny.db"
    },
    {
      "id": "WORK-004",
      "description": "Production-grade DatabasePathResolver implementation",
      "completedDate": "2025-08-27T12:00:00Z", 
      "relatedRequirement": "REQ-002",
      "notes": "Comprehensive path resolution with environment variable override, working directory independence, and centralized architecture. Eliminates nested directory bug permanently."
    },
    {
      "id": "WORK-005",
      "description": "Session Memory Implementation",
      "completedDate": "2025-08-28T00:00:00Z",
      "relatedRequirement": "REQ-001",
      "notes": "Kenny now remembers conversation context across multiple messages, enabling continuity in interactions"
    },
    {
      "id": "WORK-006",
      "description": "Fuzzy Contact Matching System",
      "completedDate": "2025-08-28T00:00:00Z",
      "relatedRequirement": "REQ-001",
      "notes": "Advanced contact resolution allowing partial name matches (e.g., 'Courtney Lim' finds 'Courtney Elyse Lim')"
    },
    {
      "id": "WORK-007",
      "description": "Tool Call Rendering Fix",
      "completedDate": "2025-08-28T00:00:00Z",
      "relatedRequirement": "REQ-001",
      "notes": "Fixed raw [TOOL_CALLS] display issue, now shows proper UI components with clean rendering"
    },
    {
      "id": "WORK-008",
      "description": "GPT-5 Style Thinking Layer",
      "completedDate": "2025-08-28T00:00:00Z",
      "relatedRequirement": "REQ-001",
      "notes": "Added transparent thinking display during tool execution, improving user understanding of AI reasoning process"
    }
  ],
  "openTasks": [
    {
      "id": "TASK-009",
      "description": "CRITICAL: Fix Tool Parameter Signature Mismatch - get_recent_messages() error",
      "priority": "critical",
      "estimatedEffort": "1-2 days",
      "blockers": [],
      "createdDate": "2025-08-28T12:00:00Z",
      "details": {
        "issue": "Tool call failures due to 'limit' parameter mismatch in get_recent_messages()",
        "rootCause": "Swift/Python API contract violations causing tool execution failures",
        "impact": "Breaks LLM tool calling system, preventing Kenny from retrieving recent activity",
        "files": [
          "/kenny-api/ollama_kenny.py (function signature)",
          "/kenny-api/main.py (tool definitions)",
          "/mac_tools/src/OrchestratorCLI.swift (backend implementation)"
        ],
        "solution": "Align parameter signatures across Swift and Python APIs"
      }
    },
    {
      "id": "TASK-010",
      "description": "CRITICAL: Implement Fuzzy Contact Matching System",
      "priority": "critical",
      "estimatedEffort": "2-3 days",
      "blockers": [],
      "createdDate": "2025-08-28T12:00:00Z",
      "details": {
        "issue": "Cannot match partial names like 'Courtney Lim' to 'Courtney Elyse Lim'",
        "rootCause": "Contact search uses exact LIKE queries without fuzzy matching",
        "impact": "Contact searches fail for partial names, reducing system effectiveness",
        "solution": "Implement Levenshtein distance, Soundex/Metaphone phonetic matching",
        "files": [
          "/kenny-api/contact_resolver.py",
          "/mac_tools/src/HybridSearch.swift",
          "New: FuzzyContactMatcher.swift"
        ],
        "algorithms": [
          "Levenshtein distance for typo tolerance",
          "Soundex/Metaphone for phonetic matching",
          "Configurable similarity thresholds"
        ]
      }
    },
    {
      "id": "TASK-011",
      "description": "CRITICAL: Reduce HybridSearch Threshold from 0.3 to 0.1",
      "priority": "critical",
      "estimatedEffort": "0.5-1 days",
      "blockers": [],
      "createdDate": "2025-08-28T12:00:00Z",
      "details": {
        "issue": "Search threshold too high (0.3) causing false negatives",
        "rootCause": "Conservative threshold excludes relevant results",
        "impact": "Users miss relevant information, degrading search effectiveness",
        "files": [
          "/mac_tools/src/HybridSearch.swift:144",
          "/mac_tools/src/ConfigurationManager.swift:133"
        ],
        "solution": "Lower threshold to 0.1 and add configurable thresholds per data source"
      }
    },
    {
      "id": "TASK-012",
      "description": "STRATEGIC: Build Unified Search Orchestrator",
      "priority": "high",
      "estimatedEffort": "4-6 days",
      "blockers": [],
      "createdDate": "2025-08-28T12:00:00Z",
      "details": {
        "issue": "3 disconnected search paths: Swift HybridSearch, Python SQL fallback, contact search",
        "rootCause": "Fragmented search architecture without unified routing",
        "impact": "Inconsistent search results, maintenance complexity, missed cross-domain results",
        "solution": "Create unified search orchestrator that routes queries intelligently",
        "architecture": [
          "Query classification (contact vs content vs mixed)",
          "Intelligent routing to appropriate search engines",
          "Result merging and deduplication",
          "Fallback chain management"
        ],
        "files": [
          "New: UnifiedSearchOrchestrator.swift",
          "/kenny-api/main.py (search routing)",
          "/mac_tools/src/HybridSearch.swift (integration)"
        ]
      }
    },
    {
      "id": "TASK-013",
      "description": "STRATEGIC: Implement Contact Entity Graph",
      "priority": "high",
      "estimatedEffort": "5-7 days",
      "blockers": ["TASK-010"],
      "createdDate": "2025-08-28T12:00:00Z",
      "details": {
        "issue": "No relationship tracking between contacts and conversations",
        "rootCause": "Contacts exist in isolation without conversation context",
        "impact": "Cannot track communication patterns, missed relationship insights",
        "solution": "Build graph database of contact relationships and communication patterns",
        "features": [
          "Contact-conversation relationship mapping",
          "Communication frequency analysis",
          "Relationship strength scoring",
          "Cross-platform contact identity resolution"
        ],
        "files": [
          "New: ContactEntityGraph.swift",
          "/kenny-api/contact_memory.db (schema updates)",
          "/mac_tools/src/Database.swift (graph queries)"
        ]
      }
    },
    {
      "id": "TASK-014",
      "description": "EMERGENCY: Fix FTS5 Database Schema Corruption - 'no such column: T.snippet'",
      "priority": "critical",
      "estimatedEffort": "2-4 days",
      "blockers": [],
      "createdDate": "2025-08-28T18:30:00Z",
      "details": {
        "issue": "FTS5_Update component failing with 'no such column: T.snippet' error during data ingestion",
        "rootCause": "SQLite FTS5 schema mismatch where query attempts to access non-existent 'snippet' column with table alias 'T'",
        "impact": "Search functionality completely broken for one data source (12.5% system failure), compromising Kenny's core value proposition",
        "urgency": "EMERGENCY - Core search functionality compromised",
        "solution": "Database schema investigation and repair",
        "investigationSteps": [
          "1. Examine FTS5 table structure in kenny.db",
          "2. Audit all queries using 'snippet' column with 'T' alias", 
          "3. Check for incomplete migrations or corrupted virtual tables",
          "4. Validate data source specific schema requirements",
          "5. Test schema repair and data re-ingestion"
        ],
        "files": [
          "/tools/comprehensive_ingest.py (ingestion process)",
          "/mac_tools/kenny.db (database schema)",
          "/mac_tools/src/Database.swift (FTS5 queries)",
          "/kenny-api/ (any FTS5 query implementations)"
        ],
        "successCriteria": [
          "All 8 data sources ingest successfully (100% success rate)",
          "FTS5 queries execute without column errors",
          "Search functionality restored across all data sources",
          "No regression in existing search capabilities"
        ],
        "riskAssessment": "HIGH - Database corruption could spread or require complete re-ingestion of 57K+ documents"
      }
    },
    {
      "id": "TASK-004",
      "description": "Implement Email & Calendar Concierge features",
      "priority": "medium", 
      "estimatedEffort": "3-5 days",
      "blockers": ["TASK-009", "TASK-010", "TASK-011"],
      "createdDate": "2025-08-27T12:00:00Z",
      "assignee": "backend-developer"
    },
    {
      "id": "TASK-007",
      "description": "Modern Chat UI Upgrade - Fixed Height Container Implementation",
      "priority": "medium",
      "estimatedEffort": "4-6 days",
      "blockers": ["TASK-009"],
      "createdDate": "2025-08-28T00:00:00Z",
      "details": {
        "issue": "Chat UI grows vertically downwards indefinitely",
        "solution": "Fixed height container with proper scrolling, modern animations, message bubbles that don't expand infinitely",
        "reference": "https://github.com/run-llama/chat-ui patterns"
      }
    },
    {
      "id": "TASK-008",
      "description": "Comprehensive Tool Capability Mapping & Testing",
      "priority": "medium",
      "estimatedEffort": "5-7 days",
      "blockers": ["TASK-009", "TASK-010", "TASK-011"],
      "createdDate": "2025-08-28T00:00:00Z"
    }
  ],
  "knownIssues": [
    {
      "id": "BUG-003",
      "description": "Tool Parameter Signature Mismatch - get_recent_messages() limit parameter",
      "severity": "critical",
      "reportedDate": "2025-08-28T12:00:00Z",
      "status": "open",
      "workaround": "None - breaks tool calling functionality",
      "impact": "Prevents LLM from executing get_recent_messages tool, degrading AI capabilities",
      "rootCause": "Swift/Python API contract violations in tool parameter definitions",
      "relatedTask": "TASK-009",
      "userReportDetails": {
        "errorMessage": "Error: get_recent_messages() got an unexpected keyword argument 'limit'",
        "userQuery": "Find me 10 recent messages",
        "context": "Kenny shows 'Kenny is thinking...' then fails with Python function signature error",
        "location": "Kenny chat interface frontend",
        "timestamp": "2025-08-28T18:00:00Z",
        "affectedFiles": [
          "kenny-api/main.py",
          "kenny-api/ollama_kenny.py"
        ]
      }
    },
    {
      "id": "BUG-004",
      "description": "Fuzzy Contact Matching Missing - Cannot match partial names",
      "severity": "critical",
      "reportedDate": "2025-08-28T12:00:00Z",
      "status": "open",
      "workaround": "Use full contact names only",
      "impact": "Contact searches fail for partial names like 'Courtney Lim' -> 'Courtney Elyse Lim'",
      "rootCause": "Contact search uses exact LIKE queries without fuzzy matching algorithms",
      "relatedTask": "TASK-010"
    },
    {
      "id": "BUG-005",
      "description": "HybridSearch Threshold Too High - False negatives in search results",
      "severity": "critical",
      "reportedDate": "2025-08-28T12:00:00Z",
      "status": "open",
      "workaround": "Use more specific search terms",
      "impact": "Relevant search results excluded due to 0.3 threshold, reducing search effectiveness",
      "rootCause": "Conservative 0.3 threshold in HybridSearch.swift and ConfigurationManager.swift",
      "relatedTask": "TASK-011"
    },
    {
      "id": "BUG-006",
      "description": "Fragmented Search Architecture - 3 disconnected search paths",
      "severity": "high",
      "reportedDate": "2025-08-28T12:00:00Z",
      "status": "open",
      "workaround": "Manually try different search approaches",
      "impact": "Inconsistent search results, maintenance complexity, missed cross-domain insights",
      "rootCause": "No unified search orchestrator routing queries intelligently",
      "relatedTask": "TASK-012"
    },
    {
      "id": "BUG-007",
      "description": "Contact Entity Graph Missing - No relationship tracking",
      "severity": "high",
      "reportedDate": "2025-08-28T12:00:00Z",
      "status": "open",
      "workaround": "Manual contact relationship management",
      "impact": "Cannot track communication patterns or relationship insights",
      "rootCause": "Contacts exist in isolation without conversation context mapping",
      "relatedTask": "TASK-013"
    },
    {
      "id": "BUG-008",
      "description": "FTS5 Database Schema Corruption - 'no such column: T.snippet' Error",
      "severity": "critical",
      "reportedDate": "2025-08-28T18:30:00Z",
      "status": "open",
      "workaround": "System partially functional (7/8 sources working)",
      "impact": "Search functionality compromised for one data source, affecting search across 57K+ documents. Users receive incomplete results when searching personal data.",
      "rootCause": "SQLite FTS5 schema mismatch where query attempts to access non-existent 'snippet' column with table alias 'T'",
      "technicalDetails": {
        "component": "FTS5_Update",
        "errorMessage": "no such column: T.snippet",
        "context": "Data ingestion process using comprehensive_ingest.py",
        "successRate": "87.5% (7/8 sources)",
        "affectedSystem": "Full-Text Search indexing for Kenny AI",
        "databaseType": "SQLite FTS5",
        "impactArea": "Search capabilities across document collection"
      },
      "systemContext": {
        "totalDocuments": "57K+",
        "partialFunctionality": true,
        "searchDegradation": "Complete failure for one data source type",
        "likelyAffectedSources": ["WhatsApp", "Mail", "Messages", "Calendar", "Contacts"],
        "coreValueProposition": "Fast text search across personal data - COMPROMISED"
      },
      "urgencyReason": "Database schema corruption directly impacts Kenny AI's core search functionality, which is fundamental to user experience and system value",
      "requiredInvestigation": [
        "Database schema integrity check",
        "FTS5 table structure validation", 
        "Migration history analysis",
        "Query pattern audit for 'snippet' column usage",
        "Data source specific schema differences"
      ],
      "potentialCauses": [
        "Incomplete database migration",
        "Corrupted FTS5 virtual table",
        "Version mismatch in SQLite FTS5 extensions",
        "Data source schema evolution without proper migration",
        "Query template using incorrect column aliases"
      ]
    },
    {
      "id": "BUG-001", 
      "description": "Database path resolution creates nested mac_tools/mac_tools/ directory structure",
      "severity": "critical",
      "reportedDate": "2025-08-27T00:00:00Z",
      "status": "resolved",
      "workaround": "No longer needed",
      "impact": "System appears broken (0 documents) when functional (56,799 documents)",
      "rootCause": "Path resolution logic in Swift incorrectly handles relative paths when executed from mac_tools directory",
      "resolution": "DatabasePathResolver class implemented with comprehensive path resolution strategy",
      "resolvedDate": "2025-08-27T12:00:00Z"
    },
    {
      "id": "BUG-002",
      "description": "Chat UI grows vertically downwards indefinitely, creating poor user experience",
      "severity": "high",
      "reportedDate": "2025-08-28T00:00:00Z",
      "status": "open",
      "workaround": "Manual scrolling required for long conversations",
      "impact": "Degrades user experience as conversations become difficult to navigate and visually overwhelming",
      "rootCause": "Missing fixed height container with proper scrolling implementation",
      "relatedTask": "TASK-007"
    }
  ],
  "decisions": [
    {
      "id": "DEC-001",
      "decision": "Prioritize database path resolution bug fix over all Week 6+ features",
      "rationale": "Critical bug creates false negative system state that blocks development and creates unreliable user experience",
      "alternatives": [
        "Continue with Week 6 features and fix later",
        "Document workaround and proceed"
      ],
      "date": "2025-08-27T00:00:00Z",
      "impact": "Delays Week 6+ roadmap but ensures system reliability"
    },
    {
      "id": "DEC-002",
      "decision": "Apply temporary manual fix while developing permanent solution", 
      "rationale": "Enables continued testing and validation while permanent fix is developed",
      "alternatives": [
        "Wait for permanent fix before proceeding",
        "Rebuild entire database from scratch"
      ],
      "date": "2025-08-27T00:00:00Z", 
      "impact": "System operational with 56,799 documents accessible for testing"
    },
    {
      "id": "DEC-003",
      "decision": "Implement DatabasePathResolver as centralized path resolution utility",
      "rationale": "Comprehensive solution eliminates path ambiguity, provides environment variable flexibility, and ensures working directory independence",
      "alternatives": [
        "Simple hardcoded path fix",
        "Continue with workarounds",
        "Redesign database architecture"
      ],
      "date": "2025-08-27T12:00:00Z",
      "impact": "Permanent solution enables reliable system operation and unblocks Week 6+ development"
    },
    {
      "id": "DEC-004",
      "decision": "Resume Week 6-8 advanced AI feature development immediately",
      "rationale": "Database path resolution blocker eliminated, system fully operational with 56,799 documents, all technical foundations in place",
      "alternatives": [
        "Additional testing and validation",
        "Performance optimization first",
        "Frontend development"
      ],
      "date": "2025-08-27T12:00:00Z",
      "impact": "Restores development velocity and progress toward production-ready AI assistant"
    },
    {
      "id": "DEC-005",
      "decision": "Prioritize modern chat UI implementation based on 2024-2025 best practices research",
      "rationale": "Current UI has critical usability flaw (infinite vertical growth) that degrades user experience. Research shows dark mode reduces eye strain by 67%, animations make wait times feel 20% shorter, and 90% of users abandon slow applications",
      "alternatives": [
        "Continue with backend-first approach",
        "Simple CSS fixes without comprehensive redesign",
        "Focus on feature completion over UX"
      ],
      "date": "2025-08-28T00:00:00Z",
      "impact": "Addresses critical UX blocker and aligns with modern user expectations for AI chat interfaces"
    },
    {
      "id": "DEC-006",
      "decision": "Implement comprehensive tool capability mapping with Playwright testing",
      "rationale": "System has extensive tool functionality but lacks visibility and reliability validation. Comprehensive mapping and testing ensures users understand capabilities and prevents regressions",
      "alternatives": [
        "Manual testing only",
        "Documentation without automated tests",
        "Focus on new features over existing tool validation"
      ],
      "date": "2025-08-28T00:00:00Z",
      "impact": "Establishes reliable foundation for tool ecosystem and improves user confidence in system capabilities"
    },
    {
      "id": "DEC-007",
      "decision": "Prioritize 5 critical issues over all other development work",
      "rationale": "Tool parameter mismatches, missing fuzzy matching, and high search thresholds are blocking core Kenny functionality. These fundamental issues must be resolved before building additional features, as they affect the reliability and effectiveness of the entire system",
      "alternatives": [
        "Continue with feature development and fix issues later",
        "Address issues incrementally alongside new features",
        "Focus on UI improvements first"
      ],
      "date": "2025-08-28T12:00:00Z",
      "impact": "Ensures solid foundation for Kenny's core search and tool execution capabilities, preventing technical debt accumulation",
      "priorityOrder": [
        "TASK-009: Tool Parameter Signature Fix (1-2 days)",
        "TASK-011: HybridSearch Threshold Reduction (0.5-1 days)", 
        "TASK-010: Fuzzy Contact Matching (2-3 days)",
        "TASK-012: Unified Search Orchestrator (4-6 days)",
        "TASK-013: Contact Entity Graph (5-7 days)"
      ]
    },
    {
      "id": "DEC-008",
      "decision": "Escalate FTS5 database schema corruption to EMERGENCY priority - halt all development",
      "rationale": "Critical database corruption (BUG-008) has compromised Kenny's core search functionality with 12.5% system failure rate. This directly attacks Kenny's fundamental value proposition of reliable personal data search. The corruption could spread or require complete re-ingestion of 57K+ documents if not addressed immediately",
      "alternatives": [
        "Work around the failing data source and continue development",
        "Accept 87.5% functionality as acceptable",
        "Schedule database repair after completing other critical tasks"
      ],
      "date": "2025-08-28T18:30:00Z",
      "impact": "All development priorities reorganized around database integrity. System status changed to 'emergency-repair'. Core search functionality must be restored before any feature development continues",
      "urgencyFactors": [
        "Core value proposition compromised (fast text search)",
        "Database corruption could spread to other sources", 
        "User experience severely degraded with incomplete search results",
        "Risk of requiring complete 57K+ document re-ingestion",
        "System reliability dropped from 'medium' to 'low'"
      ],
      "newPriorityOrder": [
        "TASK-014: EMERGENCY FTS5 Database Schema Repair (2-4 days)",
        "TASK-009: Tool Parameter Signature Fix (1-2 days)",
        "TASK-011: HybridSearch Threshold Reduction (0.5-1 days)",
        "All other tasks blocked until database integrity restored"
      ]
    }
  ],
  "systemHealth": {
    "dataLayer": "corrupted",
    "searchSystem": "critically-degraded", 
    "ingestionSystem": "partially-failing",
    "fts5DatabaseSchema": "corrupted",
    "totalDocuments": 56799,
    "lastIngestionDate": "2025-08-27T00:00:00Z", 
    "lastIngestionAttempt": "2025-08-28T18:30:00Z",
    "ingestionSuccessRate": "87.5% (7/8 sources)",
    "criticalBugs": 4,
    "systemReliability": "low",
    "pathResolutionSystem": "operational",
    "uiSystem": "needs-major-upgrade",
    "sessionMemory": "operational",
    "toolCallRendering": "operational",
    "fuzzyContactMatching": "missing",
    "thinkingLayer": "operational",
    "toolParameterSignatures": "broken-confirmed-by-user",
    "hybridSearchThreshold": "too-high",
    "searchArchitecture": "fragmented",
    "contactEntityGraph": "missing",
    "databaseIntegrity": "compromised-fts5-schema-error",
    "searchFunctionality": "incomplete-results-one-source-failing",
    "currentPhase": "emergency-database-repair-required",
    "nextMilestone": "resolve-6-critical-issues-including-database-corruption",
    "estimatedResolutionTime": "15-23 days",
    "emergencyPriority": "TASK-014 - FTS5 Database Schema Corruption",
    "coreValueProposition": "COMPROMISED - Search functionality partially broken"
  }
}